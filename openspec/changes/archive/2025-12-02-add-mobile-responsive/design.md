# 移动端适配技术设计

## Context

VitePress 默认主题已有基本的响应式支持，但针对中文文档站点的移动端体验仍有优化空间。本项目需要在不破坏默认主题的基础上，通过 CSS 覆盖和少量 JS 增强来实现全面的移动端适配。

**核心约束条件**：
- **禁止修改文档内容**: 严禁修改 `docs/` 目录下任何 `.md` 文件的内容
- **文件编码**: 所有文件必须使用 UTF-8 编码格式保存
- **内容一致性**: 移动端与 PC 端展示的教学内容必须完全一致
- **保持扩展性**: 保留 `config.mts` 所有配置项，新增样式采用增量覆盖
- **保持配置性**: 现有侧边栏、导航、主题配置必须继续正常工作
- 保持对 VitePress 升级的兼容性
- 仅使用 CSS 和少量 Vue 组件扩展
- 不引入额外的第三方 UI 库

## Goals / Non-Goals

**Goals**:
- 在 320px-768px 宽度设备上提供流畅的阅读体验
- 所有交互元素符合移动端可用性标准（触摸目标 >= 44px）
- 代码块、表格等复杂内容可正常查看
- 页面加载和滚动性能良好
- 移动端和 PC 端展示完全相同的文档内容

**Non-Goals**:
- 不实现 PWA 离线功能
- 不重新设计整体视觉风格
- 不添加移动端专属功能（如手势导航）
- 不修改任何 Markdown 文档源文件
- 不为移动端隐藏或删减任何教学内容
- 不删除或修改 `config.mts` 中的现有配置项
- 不破坏现有的主题扩展能力

## Decisions

### 1. 主题扩展方式
**决定**: 使用 VitePress 官方推荐的主题扩展方式，创建 `docs/.vitepress/theme/index.ts` 导入默认主题并添加自定义样式。

**理由**:
- 保持与 VitePress 版本升级的兼容性
- 最小化自定义代码量
- 可以选择性覆盖特定组件

### 2. 断点系统
**决定**: 使用与 VitePress 默认主题一致的断点值：
- Mobile: < 640px
- Tablet: 640px - 959px
- Desktop: >= 960px

**理由**: 复用 VitePress 已有断点，减少冲突和调试成本。

### 3. 代码块处理
**决定**: 通过 CSS 为代码块添加 `overflow-x: auto` 并调整移动端字体大小为 13px。

**理由**:
- 保持代码可读性
- 允许用户水平滚动查看长行代码
- 避免代码换行导致的阅读困难

### 4. 表格处理
**决定**: 为表格父容器添加 `overflow-x: auto`，保持表格原始布局。

**理由**:
- 表格数据通常有固定列宽需求
- 水平滚动比强制换行更易读
- 与代码块处理方式一致

### 5. 图片查看
**决定**: 暂时仅使用 CSS 限制图片最大宽度，不实现点击放大功能。

**理由**:
- VitePress 默认已支持图片点击在新标签打开
- 避免引入额外的图片查看库
- 后续如有需求可单独迭代

## Risks / Trade-offs

| 风险 | 缓解措施 |
|------|----------|
| CSS 选择器与 VitePress 更新冲突 | 使用高特异性选择器，版本升级时检查 |
| 自定义样式影响桌面端 | 所有移动端样式包裹在媒体查询中 |
| 不同浏览器表现不一致 | 测试 Chrome/Safari/Firefox 移动版 |
| 文件编码不一致 | 所有文件使用 UTF-8 编码，编辑器配置统一 |
| 误修改文档内容 | 代码审查时检查，只允许修改 theme 目录 |
| 破坏现有配置扩展性 | 采用增量覆盖方式，不修改原有配置结构 |
| 移动端样式与 PC 端冲突 | 发现冲突立即停止，询问用户意见后继续 |

## Conflict Resolution Protocol (冲突处理协议)

在实施过程中遇到以下情况时，**必须立即停止并询问用户**：

1. **样式冲突**: 移动端样式可能影响 PC 端显示效果
2. **配置冲突**: 需要修改 `config.mts` 现有配置项
3. **功能冲突**: 现有功能在移动端表现异常需要特殊处理
4. **扩展性冲突**: 新增代码可能限制未来的扩展能力
5. **不确定情况**: 任何不确定是否会产生副作用的改动

**处理流程**:
```
发现冲突 → 立即停止 → 详细描述问题 → 等待用户回复 → 按用户意见执行
```

## Implementation Rules (实施规则)

1. **文件编码**: 所有新建文件必须以 UTF-8 without BOM 格式保存
2. **修改范围**: 仅允许修改以下路径：
   - `docs/.vitepress/theme/**` (新建)
   - `docs/.vitepress/config.mts` (仅新增配置，禁止修改现有配置)
3. **禁止修改**:
   - `docs/**/*.md` - 所有 Markdown 文档
   - `docs/public/**` - 静态资源
   - `config.mts` 中的现有配置项（nav、sidebar、search、footer 等）
4. **内容原则**: 任何样式调整不得导致内容在移动端被隐藏或无法访问
5. **增量原则**: 所有改动采用增量方式，通过 CSS 覆盖而非修改源配置
6. **冲突处理**: 遇到任何冲突或不确定情况，立即停止并询问用户

## Migration Plan

1. 创建主题扩展目录结构
2. 逐步添加各模块的移动端样式
3. 在真机上测试验证
4. 根据反馈调整和优化

## Open Questions

- 是否需要针对超长代码行（>200 字符）提供特殊处理？
- ~~是否需要在移动端隐藏某些非必要元素（如页脚）？~~ **已确认：不隐藏任何内容**
