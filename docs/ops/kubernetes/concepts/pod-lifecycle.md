---
title: Pod ç”Ÿå‘½å‘¨æœŸ | Kubernetes æ•™ç¨‹
description: ç†è§£ Pod ä»åˆ›å»ºåˆ°é”€æ¯çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸï¼ŒæŒæ¡å„çŠ¶æ€çš„å«ä¹‰
---

# Pod ç”Ÿå‘½å‘¨æœŸ

æœ¬èŠ‚å¸®åŠ©ä½ ç†è§£ Pod ä»åˆ›å»ºåˆ°é”€æ¯çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸã€‚

## å‰ç½®çŸ¥è¯†

> ğŸ’¡ é˜…è¯»æœ¬ç« å‰ï¼Œè¯·ç¡®ä¿å·²å®Œæˆï¼š
> - [Pod è¯¦è§£](/ops/kubernetes/concepts/pod) - ç†è§£ Pod çš„åŸºæœ¬æ¦‚å¿µ

## Pod çš„ç”Ÿå‘½å‘¨æœŸé˜¶æ®µ

Pod çš„ç”Ÿå‘½å‘¨æœŸæœ‰ä»¥ä¸‹å‡ ä¸ªé˜¶æ®µï¼ˆPhaseï¼‰ï¼š

```mermaid
flowchart TD
    A[Pod åˆ›å»ºè¯·æ±‚] --> B[Pending<br/>ç­‰å¾…è°ƒåº¦]
    B --> C{è°ƒåº¦æˆåŠŸ?}
    C -->|æ˜¯| D[Running<br/>è¿è¡Œä¸­]
    C -->|å¦| E[è°ƒåº¦å¤±è´¥]
    D --> F{æ‰€æœ‰å®¹å™¨é€€å‡º?}
    F -->|æ­£å¸¸é€€å‡º| G[Succeeded<br/>æˆåŠŸå®Œæˆ]
    F -->|å¼‚å¸¸é€€å‡º| H[Failed<br/>å¤±è´¥]
    E --> H
    D --> I{æ— æ³•è·å–çŠ¶æ€?}
    I -->|æ˜¯| J[Unknown<br/>æœªçŸ¥]
```

## å„é˜¶æ®µè¯¦è§£

### 1. Pendingï¼ˆç­‰å¾…ä¸­ï¼‰

Pod å·²è¢« Kubernetes æ¥å—ï¼Œä½†å®¹å™¨è¿˜æœªåˆ›å»ºã€‚å¯èƒ½åŸå› ï¼š

| åŸå›  | è¯´æ˜ |
|------|------|
| ç­‰å¾…è°ƒåº¦ | Scheduler æ­£åœ¨é€‰æ‹©èŠ‚ç‚¹ |
| é•œåƒæ‹‰å– | æ­£åœ¨ä»ä»“åº“ä¸‹è½½é•œåƒ |
| èµ„æºä¸è¶³ | æ²¡æœ‰èŠ‚ç‚¹æ»¡è¶³èµ„æºè¦æ±‚ |

```bash
# æŸ¥çœ‹ Pending åŸå› 
kubectl describe pod <pod-name>
```

### 2. Runningï¼ˆè¿è¡Œä¸­ï¼‰

Pod å·²ç»‘å®šåˆ°èŠ‚ç‚¹ï¼Œæ‰€æœ‰å®¹å™¨å·²åˆ›å»ºï¼Œè‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨æ­£åœ¨è¿è¡Œã€‚

> ğŸ’¡ **æ³¨æ„**ï¼šRunning ä¸ç­‰äº"å¥åº·"ã€‚å®¹å™¨å¯èƒ½åœ¨è¿è¡Œä½†æœåŠ¡ä¸å¯ç”¨ã€‚

### 3. Succeededï¼ˆæˆåŠŸï¼‰

Pod ä¸­çš„æ‰€æœ‰å®¹å™¨éƒ½å·²æˆåŠŸç»ˆæ­¢ï¼ˆé€€å‡ºç ä¸º 0ï¼‰ï¼Œä¸ä¼šé‡å¯ã€‚

å¸¸è§äºï¼š
- ä¸€æ¬¡æ€§ä»»åŠ¡ï¼ˆJobï¼‰
- æ•°æ®è¿ç§»è„šæœ¬
- æ‰¹å¤„ç†ä½œä¸š

### 4. Failedï¼ˆå¤±è´¥ï¼‰

Pod ä¸­çš„æ‰€æœ‰å®¹å™¨éƒ½å·²ç»ˆæ­¢ï¼Œä¸”è‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨ä»¥éé›¶çŠ¶æ€é€€å‡ºã€‚

```bash
# æŸ¥çœ‹å®¹å™¨é€€å‡ºç 
kubectl get pod <pod-name> -o jsonpath='{.status.containerStatuses[0].state.terminated.exitCode}'
```

### 5. Unknownï¼ˆæœªçŸ¥ï¼‰

æ— æ³•è·å– Pod çŠ¶æ€ï¼Œé€šå¸¸æ˜¯ä¸èŠ‚ç‚¹é€šä¿¡å¤±è´¥ã€‚

## å®¹å™¨çŠ¶æ€

Pod é˜¶æ®µæ˜¯å®è§‚çŠ¶æ€ï¼Œå®¹å™¨ä¹Ÿæœ‰è‡ªå·±çš„å¾®è§‚çŠ¶æ€ï¼š

```mermaid
flowchart TD
    A[Waiting<br/>ç­‰å¾…ä¸­] --> B[Running<br/>è¿è¡Œä¸­]
    B --> C[Terminated<br/>å·²ç»ˆæ­¢]
    C -->|é‡å¯ç­–ç•¥| A
```

### Waitingï¼ˆç­‰å¾…ä¸­ï¼‰

å®¹å™¨æ­£åœ¨æ‰§è¡Œå¯åŠ¨å‰çš„æ“ä½œï¼š
- æ‹‰å–é•œåƒ
- åº”ç”¨ Secret
- ç­‰å¾…ä¾èµ–

### Runningï¼ˆè¿è¡Œä¸­ï¼‰

å®¹å™¨æ­£åœ¨æ‰§è¡Œä¸­ï¼Œæ²¡æœ‰é—®é¢˜ã€‚

### Terminatedï¼ˆå·²ç»ˆæ­¢ï¼‰

å®¹å™¨å·²ç»æ‰§è¡Œå®Œæ¯•æˆ–å› æ•…éšœåœæ­¢ï¼š
- æ­£å¸¸å®Œæˆï¼ˆé€€å‡ºç  0ï¼‰
- å‡ºé”™é€€å‡ºï¼ˆé€€å‡ºç é 0ï¼‰
- è¢« OOM æ€æ­»

## é‡å¯ç­–ç•¥

Pod çš„ `restartPolicy` å†³å®šå®¹å™¨ç»ˆæ­¢åçš„è¡Œä¸ºï¼š

| ç­–ç•¥ | è¯´æ˜ | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| `Always` | æ€»æ˜¯é‡å¯ï¼ˆé»˜è®¤ï¼‰ | é•¿æœŸè¿è¡Œçš„æœåŠ¡ |
| `OnFailure` | å¤±è´¥æ—¶é‡å¯ | æ‰¹å¤„ç†ä»»åŠ¡ |
| `Never` | ä»ä¸é‡å¯ | ä¸€æ¬¡æ€§ä»»åŠ¡ |

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: restart-demo
spec:
  restartPolicy: OnFailure   # åªåœ¨å¤±è´¥æ—¶é‡å¯
  containers:
  - name: demo
    image: busybox
    command: ['sh', '-c', 'exit 1']  # æ¨¡æ‹Ÿå¤±è´¥
```

## å¥åº·æ£€æŸ¥æ¢é’ˆ

K8s æä¾›ä¸‰ç§æ¢é’ˆæ¥æ£€æµ‹å®¹å™¨å¥åº·çŠ¶æ€ï¼š

### 1. livenessProbeï¼ˆå­˜æ´»æ¢é’ˆï¼‰

æ£€æµ‹å®¹å™¨æ˜¯å¦åœ¨è¿è¡Œã€‚å¤±è´¥åˆ™**é‡å¯å®¹å™¨**ã€‚

```yaml
livenessProbe:
  httpGet:
    path: /healthz        # å¥åº·æ£€æŸ¥ç«¯ç‚¹
    port: 8080
  initialDelaySeconds: 3  # å¯åŠ¨åç­‰å¾…æ—¶é—´
  periodSeconds: 3        # æ£€æŸ¥é—´éš”
```

### 2. readinessProbeï¼ˆå°±ç»ªæ¢é’ˆï¼‰

æ£€æµ‹å®¹å™¨æ˜¯å¦å‡†å¤‡å¥½æ¥æ”¶æµé‡ã€‚å¤±è´¥åˆ™**ä» Service ä¸­ç§»é™¤**ã€‚

```yaml
readinessProbe:
  httpGet:
    path: /ready
    port: 8080
  initialDelaySeconds: 5
  periodSeconds: 5
```

### 3. startupProbeï¼ˆå¯åŠ¨æ¢é’ˆï¼‰

æ£€æµ‹åº”ç”¨æ˜¯å¦å·²å¯åŠ¨ã€‚å¤±è´¥åˆ™**é‡å¯å®¹å™¨**ã€‚

```yaml
startupProbe:
  httpGet:
    path: /startup
    port: 8080
  failureThreshold: 30    # æœ€å¤šå¤±è´¥ 30 æ¬¡
  periodSeconds: 10       # æ¯ 10 ç§’æ£€æŸ¥ä¸€æ¬¡
```

### æ¢é’ˆå·¥ä½œæµç¨‹

```mermaid
flowchart TD
    A[å®¹å™¨å¯åŠ¨] --> B{startupProbe<br/>é€šè¿‡?}
    B -->|å¦| C[é‡å¯å®¹å™¨]
    B -->|æ˜¯| D{livenessProbe<br/>é€šè¿‡?}
    D -->|å¦| C
    D -->|æ˜¯| E{readinessProbe<br/>é€šè¿‡?}
    E -->|å¦| F[ä» Service ç§»é™¤]
    E -->|æ˜¯| G[æ­£å¸¸æ¥æ”¶æµé‡]
    F --> D
    G --> D
```

## å¸¸è§æ¢é’ˆé…ç½®

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: probe-demo
spec:
  containers:
  - name: web
    image: nginx:1.21
    ports:
    - containerPort: 80

    # å­˜æ´»æ¢é’ˆï¼šæ£€æµ‹å®¹å™¨æ˜¯å¦è¿è¡Œ
    livenessProbe:
      httpGet:
        path: /
        port: 80
      initialDelaySeconds: 5   # å¯åŠ¨å 5 ç§’å¼€å§‹æ£€æŸ¥
      periodSeconds: 10        # æ¯ 10 ç§’æ£€æŸ¥ä¸€æ¬¡
      timeoutSeconds: 1        # è¶…æ—¶æ—¶é—´ 1 ç§’
      failureThreshold: 3      # è¿ç»­å¤±è´¥ 3 æ¬¡åˆ™é‡å¯

    # å°±ç»ªæ¢é’ˆï¼šæ£€æµ‹å®¹å™¨æ˜¯å¦å‡†å¤‡å¥½æ¥æ”¶æµé‡
    readinessProbe:
      httpGet:
        path: /
        port: 80
      initialDelaySeconds: 5
      periodSeconds: 5
```

## å°ç»“

- Pod ç”Ÿå‘½å‘¨æœŸï¼š**Pending â†’ Running â†’ Succeeded/Failed**
- å®¹å™¨çŠ¶æ€ï¼š**Waiting â†’ Running â†’ Terminated**
- é‡å¯ç­–ç•¥ï¼š**Always**ï¼ˆé»˜è®¤ï¼‰ã€**OnFailure**ã€**Never**
- ä¸‰ç§æ¢é’ˆï¼š**liveness**ï¼ˆå­˜æ´»ï¼‰ã€**readiness**ï¼ˆå°±ç»ªï¼‰ã€**startup**ï¼ˆå¯åŠ¨ï¼‰

## ä¸‹ä¸€æ­¥

äº†è§£äº† Pod çš„ç”Ÿå‘½å‘¨æœŸåï¼Œè®©æˆ‘ä»¬æ¥è®¤è¯† K8s çš„å…¶ä»–æ ¸å¿ƒç»„ä»¶ã€‚

[ä¸‹ä¸€èŠ‚ï¼šæ ¸å¿ƒç»„ä»¶](/ops/kubernetes/concepts/components)
